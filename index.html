<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAX 원장/선생님 페이지</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        /* 학생용 index.html 스타일과 거의 동일 */
        :root {
            --primary: #2563eb; /* 관리자 페이지는 파란색 계열로 */
            --dark: #1e1e2e;
            --light: #f8f9fa;
            --gray: #adb5bd;
            --gray-light: #e9ecef;
            --danger: #ef4444; /* 관리자 메뉴 색상 */
            --info: #0ea5e9; /* 공지사항 메뉴 색상 */
            --success: #10b981; /* 기록 열람 메뉴 색상 (선택 사항) */
        }
        * { box-sizing: border-box; }
        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            display: flex; flex-direction: column;
        }
        #contentFrame {
            flex: 1; border: none; width: 100%;
            overflow-y: auto;
        }
        .bottom-nav {
            flex-shrink: 0; display: flex; justify-content: space-around;
            align-items: center; width: 100%; height: 70px;
            background-color: #ffffff;
            border-top: 1px solid var(--gray-light);
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
            padding-bottom: env(safe-area-inset-bottom);
            position: relative; z-index: 100;
        }
        .nav-button {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; flex: 1; text-decoration: none;
            color: var(--gray); font-size: 11px; padding: 8px 0;
            transition: all 0.3s ease; position: relative;
        }
        .nav-button i { font-size: 22px; margin-bottom: 4px; }
        .nav-button.active { color: var(--primary); }
        .nav-button.active::after {
            content: ''; position: absolute; bottom: 0;
            width: 24px; height: 3px;
            background-color: var(--primary);
            border-radius: 2px;
        }

        /* ⭐️ 관리자/특정 직급 전용 메뉴 스타일 */
        .nav-button.restricted-access {
            display: none; /* 평소엔 숨김 */
        }
        /* 반 배정 메뉴 스타일 */
        .nav-button.restricted-access.assignment-menu { color: var(--danger); }
        .nav-button.restricted-access.assignment-menu.active { color: var(--danger); }
        .nav-button.restricted-access.assignment-menu.active::after { background-color: var(--danger); }
        /* 공지사항 메뉴 스타일 */
        .nav-button.restricted-access.announcement-menu { color: var(--info); }
        .nav-button.restricted-access.announcement-menu.active { color: var(--info); }
        .nav-button.restricted-access.announcement-menu.active::after { background-color: var(--info); }

        /* ⭐️ 기록 열람 메뉴 스타일 (모든 선생님/원장 기본 색상) */
        .nav-button.record-view-menu.active { color: var(--success); } /* 활성화 시 초록색 (선택) */
        .nav-button.record-view-menu.active::after { background-color: var(--success); } /* 밑줄도 초록색 */


        /* 공통: show 클래스가 붙으면 보이게 */
        .nav-button.restricted-access.show { display: flex; }

       /* 로딩 인디케이터 */
        .loading {
            display: none; position: absolute; top: 0; left: 0;
            width: 100%; height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--danger));
            z-index: 1000; animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body>
    <div class="loading" id="loadingIndicator"></div>

    <iframe id="contentFrame" src="welcome.html" name="contentFrame"></iframe>

    <nav class="bottom-nav">
        <a href="admin_assign_workout.html" class="nav-button active" target="contentFrame" onclick="setActive(this)">
            <i class="fa-solid fa-clipboard-list"></i>
            <span>운동 할당</span>
        </a>
        <a href="admin_student_notes.html" class="nav-button" target="contentFrame" onclick="setActive(this)">
            <i class="fa-solid fa-file-medical"></i>
            <span>학생 메모</span>
        </a>
        <a href="admin_student_dashboard.html" class="nav-button" target="contentFrame" onclick="setActive(this)">
            <i class="fa-solid fa-users"></i>
            <span>학생 명단</span>
        </a>
        <a href="admin_student_records_view.html" class="nav-button record-view-menu" target="contentFrame" onclick="setActive(this)">
            <i class="fa-solid fa-clipboard-check"></i>
            <span>기록 열람</span>
        </a>
        <a href="admin_student_announcements.html" class="nav-button restricted-access announcement-menu" id="announcementMenu" target="contentFrame" onclick="setActive(this)">
            <i class="fa-solid fa-bullhorn"></i>
            <span>공지 관리</span>
        </a>
        <a href="admin_student_assignment.html" class="nav-button restricted-access assignment-menu" id="assignmentMenu" target="contentFrame" onclick="setActive(this)">
            <i class="fa-solid fa-user-shield"></i>
            <span>반 배정</span>
        </a>
    </nav>

    <script>
        // ⭐️ 로그인 페이지 (인증 실패 시 이동할 곳)
        const LOGIN_PAGE = 'admin_login.html';

        // 1. 하단 메뉴 활성화 함수 (기존과 동일)
        function setActive(element) {
            document.getElementById('loadingIndicator').style.display = 'block';
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
            });
            element.classList.add('active');
            // iframe 로드 완료 시 로딩 숨김 (기존과 동일)
            const frame = document.getElementById('contentFrame');
            const hideLoading = () => {
                document.getElementById('loadingIndicator').style.display = 'none';
                frame.removeEventListener('load', hideLoading); // 이벤트 리스너 제거
            };
            frame.addEventListener('load', hideLoading);
        }

        // 2. 페이지 로드 시 실행 (관리자/직급 확인 로직 유지)
        window.addEventListener('load', function() {
            document.getElementById('loadingIndicator').style.display = 'none';

            const token = localStorage.getItem('jwt_token');
            if (!token) {
                alert('로그인이 필요합니다.');
                window.location.href = LOGIN_PAGE;
                return;
            }

            try {
                // 토큰 디코딩
                const payloadBase64Url = token.split('.')[1];
                const payloadBase64 = payloadBase64Url.replace(/-/g, '+').replace(/_/g, '/');
                const decodedString = new TextDecoder().decode(Uint8Array.from(atob(payloadBase64), c => c.charCodeAt(0)));
                const payload = JSON.parse(decodedString);

                console.log('로그인 사용자 정보:', payload); // 디버깅용: 토큰 내용 확인

                // ▼▼▼ 메뉴 표시 로직 유지 ▼▼▼
                const announcementMenu = document.getElementById('announcementMenu'); // 공지사항 메뉴
                const assignmentMenu = document.getElementById('assignmentMenu'); // 반 배정 메뉴
                const managementPositions = ['원장', '부원장', '팀장']; // 관리 권한 직급 목록

                // 1. 공지사항 관리 메뉴 표시 조건: 직급이 원장/부원장/팀장 중 하나인가?
                if (payload.position && managementPositions.includes(payload.position)) {
                    if (announcementMenu) {
                        announcementMenu.classList.add('show');
                        console.log('공지사항 관리 메뉴 활성화 (직급 기반)');
                    }
                }

                // 2. 반 배정 메뉴 표시 조건: 직급이 원장/부원장/팀장 중 하나이거나, 아이디가 'sean8320'인가?
                if ((payload.position && managementPositions.includes(payload.position)) || payload.userid === 'sean8320') {
                    if (assignmentMenu) {
                        assignmentMenu.classList.add('show');
                        console.log('반 배정 메뉴 활성화 (직급 또는 ID 기반)');
                    }
                }
                // ▲▲▲ 메뉴 표시 로직 유지 ▲▲▲

                // 학생 계정 접근 차단 (기존과 동일)
                if (payload.role === 'student') {
                     alert('관리자/선생님 계정으로 로그인해주세요.');
                     window.location.href = LOGIN_PAGE;
                }

            } catch (e) {
                console.error('토큰 처리 실패:', e);
                alert('인증 정보 오류. 다시 로그인해주세요.');
                localStorage.removeItem('jwt_token');
                window.location.href = LOGIN_PAGE;
            }
        });
    </script>
</body>
</html>
